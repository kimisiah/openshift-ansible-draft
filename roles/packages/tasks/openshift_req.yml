- block:
    - name: Install Required Packages
      yum: name={{ item }} state=present
      with_items: "{{ list_of_oc_packages }}"
  
    - name: Update Packages
      yum: name=* state=latest
  
    - name: Install and Enable NetworkManager
      yum: name=NetworkManager state=present
  
    - name: Enable and Start NetworkManager
      service: name=NetworkManager enabled=yes state=started
  
    - name: Install Docker
      yum: name=docker state=present
  
    - name: Update Docker Options
      lineinfile: dest=/etc/sysconfig/docker regexp='^OPTIONS=' line='\OPTIONS="--selinux-enabled --insecure-registry 172.30.0.0/16  --log-opt max-size=1M --log-opt max-file=3"'

#    - name: Update Docker Options
#      shell: sed -i '/OPTIONS=.*/c\OPTIONS="--selinux-enabled --insecure-registry 172.30.0.0/16  --log-opt max-size=1M --log-opt max-file=3"' /etc/sysconfig/docker

    - name: Update Docker Storage Setup
      blockinfile:
        dest: /etc/sysconfig/docker-storage-setup
        block: |
          DEVS=/dev/xvdb
          VG=docker-vg
  
    - name: Remove Default Docker Storage Library
      file: path=/var/lib/docker state=absent
  
    - name: Startup Storage Device
      shell: docker-storage-setup
  
    - name: Enable and Start Docker Service
      service: name=docker enabled=yes state=started

  become: true
  become_user: root
